!function(e,t){if("function"==typeof define&&define.amd)define(["backbone","underscore","jquery","exports"],function(n,r,i,s){e.B2=t(e,s,n,r,i)});else if("undefined"!=typeof exports){var n=require("backbone"),r=require("underscore");t(e,exports,n,r)}else e.B2=t(e,{},e.Backbone,e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r,i){var s=e.B2;t.VERSION="0.1.6",t.noConflict=function(){return e.B2=s,this};var o={};try{o=window.localStorage}catch(e){}t.localStorage=o,r.extend(t,n),t.rootViews={},t.getComponentByUniqueName=function(e){function n(e,t){var i;return r.each(e,function(e){if(i)return!1;i=e._uuid+"_"+e._componentName===t?e:n(e._components,t)}),i}return n(t.rootViews,e)},t.View=n.View.extend({template:function(){return""},appEvents:{},broadcastEvents:{},broadcast:function(){var e=[].slice.apply(arguments);e.unshift("__broadcast__"),this.trigger.apply(this,e)},registerComponent:function(e,n,s,o){var a;if(this._parentView||(t.rootViews[this.cid]=this),this._components=this._components||{},this._components.hasOwnProperty(e)){var p=this._components[e];p.trigger&&p.trigger("beforeRemove"),this.stopListening(p,"all"),p.remove()}this._components[e]=n,n._parentView=this,n._componentName=e,n._uuid=r.uniqueId(),n.$el.attr("data-component-unique-name",n._uuid+"_"+e);var c=/^(\S+)\s*(\S+)$/;for(var h in this.appEvents)if(this.appEvents.hasOwnProperty(h)){var l=this.appEvents[h],u=h.match(c),d=u[1],f=u[2];if(u&&f){var v=/\/(.*?)\//.exec(f),_=v&&v[1];_&&(f=new RegExp(_.replace(/\\/g,"\\\\")))}if(f){var m=!1;if(r.isRegExp(f)&&f.test(e)?m=!0:f==e&&(m=!0),m){var y=d.split(/,/),g=this[l];for(a=0;a<y.length;a++)"all"!==y[a]&&this.listenTo(n,y[a],g)}}}return this.listenTo(n,"all",function(e){"__broadcast__"!==e&&(this.appEvents.hasOwnProperty("all")?this[this.appEvents.all].apply(this,[arguments[0],n].concat(r.toArray(arguments).slice(1))):n._events&&n._events[e]||this.trigger.apply(this,arguments))}),n.listenTo(this,"__broadcast__",function(){var e=[].slice.apply(arguments),t=e.shift();if(n.broadcastEvents.hasOwnProperty(t)){var i=n.broadcastEvents[t];(r.isString(i)?n[i]:i).apply(n,e)}else n.broadcast.apply(n,arguments)}),s&&(r.isString(s)?this.$(s).append(n.el):i(s).append(n.el),!0!==o&&n.render()),n},getComponent:function(e){return this._components?this._components[e]:null},getComponents:function(){return this._components||{}},freeChildren:function(e){r.each(this._components,function(t,n){(!e||(r.isRegExp(e)?e.test(n):e===n||e===t))&&(this.stopListening(t,"all"),t.remove(),this._components[n]&&(delete this._components[n],delete t._parentView))},this)},_addFieldToFormParams:function(e,t,n){if(r.isObject(n)&&!r.isArray(n)){var i=n[e];if(void 0===i)n[e]=t;else if(r.isArray(i))r.isArray(i)&&i.push(t);else{var s=i;n[e]=[s],n[e].push(t)}}else r.isArray(n)&&n.push({name:e,value:t})},_parseSerializeOpts:function(e){var t={},n=(e||"").split(";"),s={false:!1,true:!0};return r.each(n,function(e){e=e.split(":");var n=i.trim(e[0]),o=i.trim(e[1]);t[n]=r.isUndefined(s[o])?o:s[o]}),r.defaults(t,{trim:!0})},serializeForm:function(e,t,n,s){var o=this;e=e||this.el;var a=i(e).find("input, select, textarea").filter(function(){var n=!1,r=i(this).closest("."+s);return 0===r.length?n=!0:i.contains(e,r[0])||(n=!0),n&&this.name&&-1===this.name.indexOf(t||"ignore")}),p={};return n&&(p=[]),a.each(function(){var e=i(this),t=e.attr("name"),n=o._parseSerializeOpts(e.attr("data-serialize-opts")),s=e.val();s=n.trim?i.trim(s):s;var a=e.attr("value2"),c=!0,h=e.attr("data-inverse-value"),l=e.data("dataTypeToParse");switch(e.prop("type")){case"radio":e.prop("checked")?t=e.attr("name"):c=!1;break;case"checkbox":e.prop("checked")?null!=s&&"on"!=s||(s=!0):s=null!=a&&a,h&&(s=!s)}if(r.isString(l))switch(l.toLowerCase()){case"int":var u=parseInt(s,10);s=isNaN(u)?s:u;break;case"float":var d=parseFloat(s);s=isNaN(d)?s:d}c&&o._addFieldToFormParams(t,s,p)}),p},serializeArray:function(e,t){return this.serializeForm(e,t,!0)},getParentView:function(){return this._parentView},remove:function(){this.freeChildren(),this.trigger("beforeRemove");var e=this._parentView;e?(e.stopListening(this),e._components&&delete e._components[this._componentName],delete this._parentView):delete t.rootViews[this.cid],n.View.prototype.remove.apply(this,arguments)},render:function(){this.$el.html(this.template())}}),t.Model=n.Model.extend({}),t.Collection=n.Collection.extend({}),t.Router=n.Router.extend({}),t.History=n.History.extend({});var a=function(e,t,n){n=n||[];var i,s=this,o=s.prototype;i=e&&r.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},r.extend(i,s,t);var a=function(){this.constructor=i};a.prototype=s.prototype;var p=i.prototype=new a,c=/xyz/.test(function(){return"xyz"})?/\b_super\b/:/.*/,h=/'manage ajax';/;for(var l in e)e.hasOwnProperty(l)&&(p[l]="function"==typeof e[l]&&(h.test(e[l])||"function"==typeof o[l]&&(c.test(e[l])||n.indexOf(l)>-1))?function(e,t){return function(){var n=this._super;h.test(t)&&(t.viewId="_"+this.cid+"_"),this._super=o[e];var r=t.apply(this,arguments);return this._super=n,r}}(l,e[l]):e[l]);return i.__super__=s.prototype,i};t.Model.extend=t.Collection.extend=t.Router.extend=t.View.extend=t.History.extend=a;var p=t.View.extend;t.View.extend=function(e,t){if(e.render){var n=e.render;e.render=function(){this.onRenderBegin&&this.onRenderBegin(),this.freeChildren&&this.freeChildren();var e=n.apply(this,arguments);return this.onRenderEnd&&this.onRenderEnd(),e}}var i=p.call(this,e,t,["render"]);return i.prototype.events=r.extend({},this.prototype.events,e.events),i.prototype.appEvents=r.extend({},this.prototype.appEvents,e.appEvents),i.prototype.broadcastEvents=r.extend({},this.prototype.broadcastEvents,e.broadcastEvents),i}});
//# sourceMappingURL=b2-min.js.map