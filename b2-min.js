!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","jquery","exports"],function(c,d,e,f){a.B2=b(a,f,c,d,e)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore");b(a,exports,c,d)}else a.B2=b(a,{},a.Backbone,a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d,e){var f=a.B2;b.VERSION="0.1.6",b.noConflict=function(){return a.B2=f,this};var g={};try{g=window.localStorage}catch(h){}b.localStorage=g,d.extend(b,c),b.View=c.View.extend({template:function(){return""},appEvents:{},broadcastEvents:{},broadcast:function(){var a=[].slice.apply(arguments);a.unshift("__broadcast__"),this.trigger.apply(this,a)},registerComponent:function(a,b,c,f){var g;if(this._components=this._components||{},this._components.hasOwnProperty(a)){var h=this._components[a];h.trigger&&h.trigger("beforeRemove"),this.stopListening(h,"all"),h.remove()}this._components[a]=b,b._parentView=this,b._componentName=a;var i=/^(\S+)\s*(\S+)$/;for(var j in this.appEvents)if(this.appEvents.hasOwnProperty(j)){var k=this.appEvents[j],l=j.match(i),m=l[1],n=l[2];if(l&&n){var o=/\/(.*?)\//.exec(n),p=o&&o[1];p&&(n=new RegExp(p.replace(/\\/g,"\\\\")))}if(n){var q=!1;if(d.isRegExp(n)&&n.test(a)?q=!0:n==a&&(q=!0),q){var r=m.split(/,/),s=this[k];for(g=0;g<r.length;g++)"all"!==r[g]&&this.listenTo(b,r[g],s)}}}return this.listenTo(b,"all",function(a){if("__broadcast__"!==a)if(this.appEvents.hasOwnProperty("all")){var c=this.appEvents.all;this[c].apply(this,[arguments[0],b].concat(d.toArray(arguments).slice(1)))}else b._events&&b._events[a]||this.trigger.apply(this,arguments)}),b.listenTo(this,"__broadcast__",function(){var a=[].slice.apply(arguments),c=a.shift();if(b.broadcastEvents.hasOwnProperty(c)){var e,f=b.broadcastEvents[c];e=d.isString(f)?b[f]:f,e.apply(b,a)}else b.broadcast.apply(b,arguments)}),c&&(d.isString(c)?this.$(c).append(b.el):e(c).append(b.el),f!==!0&&b.render()),b},getComponent:function(a){return this._components?this._components[a]:null},getComponents:function(){return this._components||{}},freeChildren:function(a){d.each(this._components,function(b,c){var e=!1;e=a?d.isRegExp(a)?a.test(c):a===c||a===b:!0,e&&(this.stopListening(b,"all"),b.remove(),this._components[c]&&(delete this._components[c],delete b._parentView))},this)},_addFieldToFormParams:function(a,b,c){if(d.isObject(c)&&!d.isArray(c)){var e=c[a];if("undefined"==typeof e)c[a]=b;else if(d.isArray(e))d.isArray(e)&&e.push(b);else{var f=e;c[a]=[f],c[a].push(b)}}else d.isArray(c)&&c.push({name:a,value:b})},_parseSerializeOpts:function(a){var b={},c=(a||"").split(";"),f={"false":!1,"true":!0};return d.each(c,function(a){a=a.split(":");var c=e.trim(a[0]),g=e.trim(a[1]);b[c]=d.isUndefined(f[g])?g:f[g]}),d.defaults(b,{trim:!0})},serializeForm:function(a,b,c,f){var g=this;a=a||this.el;var h=e(a).find("input, select, textarea").filter(function(){var c=!1,d=e(this).closest("."+f);return 0===d.length?c=!0:e.contains(a,d[0])||(c=!0),c&&this.name&&-1===this.name.indexOf(b||"ignore")}),i={};return c&&(i=[]),h.each(function(){var a=e(this),b=a.attr("name"),c=g._parseSerializeOpts(a.attr("data-serialize-opts")),f=a.val();f=c.trim?e.trim(f):f;var h=a.attr("value2"),j=!0,k=a.attr("data-inverse-value"),l=a.data("dataTypeToParse");switch(a.prop("type")){case"radio":a.prop("checked")?b=a.attr("name"):j=!1;break;case"checkbox":a.prop("checked")?(null==f||"on"==f)&&(f=!0):f=null==h?!1:h,k&&(f=!f)}if(d.isString(l))switch(l.toLowerCase()){case"int":var m=parseInt(f,10);f=isNaN(m)?f:m;break;case"float":var n=parseFloat(f);f=isNaN(n)?f:n}j&&g._addFieldToFormParams(b,f,i)}),i},serializeArray:function(a,b){return this.serializeForm(a,b,!0)},getParentView:function(){return this._parentView},remove:function(){this.freeChildren(),this.trigger("beforeRemove");var a=this._parentView;a&&(a.stopListening(this),a._components&&delete a._components[this._componentName],delete this._parentView),c.View.prototype.remove.apply(this,arguments)},render:function(){this.$el.html(this.template())}}),b.Model=c.Model.extend({}),b.Collection=c.Collection.extend({}),b.Router=c.Router.extend({}),b.History=c.History.extend({});var i=function(a,b,c){c=c||[];var e,f=this,g=f.prototype;e=a&&d.has(a,"constructor")?a.constructor:function(){return f.apply(this,arguments)},d.extend(e,f,b);var h=function(){this.constructor=e};h.prototype=f.prototype;var i=e.prototype=new h,j=/xyz/.test(function(){return"xyz"})?/\b_super\b/:/.*/,k=/'manage ajax';/;for(var l in a)a.hasOwnProperty(l)&&(i[l]="function"==typeof a[l]&&(k.test(a[l])||"function"==typeof g[l]&&(j.test(a[l])||c.indexOf(l)>-1))?function(a,b){return function(){var c=this._super;k.test(b)&&(b.viewId="_"+this.cid+"_"),this._super=g[a];var d=b.apply(this,arguments);return this._super=c,d}}(l,a[l]):a[l]);return e.__super__=f.prototype,e};b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=b.History.extend=i;var j=b.View.extend;b.View.extend=function(a,b){if(a.render){var c=a.render;a.render=function(){this.onRenderBegin&&this.onRenderBegin(),this.freeChildren&&this.freeChildren();var a=c.apply(this,arguments);return this.onRenderEnd&&this.onRenderEnd(),a}}var e=j.call(this,a,b,["render"]);return e.prototype.events=d.extend({},this.prototype.events,a.events),e.prototype.appEvents=d.extend({},this.prototype.appEvents,a.appEvents),e.prototype.broadcastEvents=d.extend({},this.prototype.broadcastEvents,a.broadcastEvents),e}});
//# sourceMappingURL=b2-min.js.map